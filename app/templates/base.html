<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=1080, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>RoomCTL</title>
  <!-- <script src="https://cdn.tailwindcss.com"></script> -->
  <link rel="stylesheet" href="static/roomctl.css">
  <link rel="stylesheet" href="static/tailwind.css">
</head>
<!-- <body class="bg-slate-900 text-slate-100 overflow-hidden"> -->
<body>
  {% block content %}{% endblock %}
  <script>
    (function(){
      // Clock label (top-right)
      function formatClock(date){
        const dateStr = new Intl.DateTimeFormat('it-IT', { weekday:'short', day:'numeric', month:'short' })
          .format(date)
          .replace(',', '')
          .trim();
        const timeStr = new Intl.DateTimeFormat('it-IT', { hour:'2-digit', minute:'2-digit' }).format(date);
        return dateStr.charAt(0).toUpperCase() + dateStr.slice(1) + '  ' + timeStr;
      }

      function updateClock(){
        const now = new Date();
        document.querySelectorAll('[data-clock]').forEach(el => {
          el.textContent = formatClock(now);
        });
      }

      function scheduleClock(){
        updateClock();
        const now = new Date();
        const msToNextMinute = (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
        setTimeout(() => {
          updateClock();
          setInterval(updateClock, 60 * 1000);
        }, msToNextMinute);
      }

      scheduleClock();

      try {
        const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
        const ws = new WebSocket(proto + '//' + location.host + '/ws');
        ws.onmessage = (ev)=>{
          try{
            const s = JSON.parse(ev.data||'{}');
            const el = document.getElementById('badge-input');
            if (el){
              const inp = (s.projector && s.projector.input) || s.projector_input || 'â€”';
              const pwr = (s.projector && s.projector.power===true) || s.projector_power===true;
              el.textContent = 'Input: ' + inp;
              el.className = 'badge ' + (pwr?'ok':'warn');
            }
            const st = document.getElementById('json-state');
            if(st){ st.textContent = JSON.stringify(s, null, 2); }
          }catch(e){}
        };
      } catch(e){}
    })();
  </script>
</body>
</html>
